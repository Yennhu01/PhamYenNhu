----CAU 1----
CREATE TABLE MONHOC(
    MAMON CHAR(5) NOT NULL PRIMARY KEY,
    TENMON NVARCHAR(20),
    SOTC INT
)
CREATE TABLE SINHVIEN(
    MASV CHAR(5) NOT NULL PRIMARY KEY,
    HOTEN NVARCHAR(30),
    NGAYSINH SMALLDATETIME
)
CREATE TABLE DIEM(
    MASV CHAR(5) NOT NULL,
    MAMON CHAR(5) NOT NULL,
    DIEMTHI FLOAT,
    CONSTRAINT FK_MASV FOREIGN  KEY(MASV) REFERENCES SINHVIEN(MASV),
    CONSTRAINT FK_MAMH FOREIGN KEY(MAMON) REFERENCES MONHOC(MAMON),
    CONSTRAINT PK_MASV_MAMH PRIMARY KEY(MASV, MAMON)
)
GO
INSERT INTO MONHOC VALUES
('MH1','TIENG ANH',2),
('MH2','CO SO DU LIEU NANG CAO',3),
('MH3','BIGDATA',3)
INSERT INTO SINHVIEN VALUES
('SV1','TRONG PHU','2002-04-24'),
('SV2','QUANG THUAN','2002-02-13'),
('SV3','YEN NHU','2003-11-13')
INSERT INTO DIEM VALUES
('SV1','MH1',9),
('SV2','MH2',8),
('SV3','MH3',10),
('SV1','MH2',10),
('SV2','MH3',9)
GO
SELECT * FROM MONHOC
GO
SELECT * FROM SINHVIEN
GO
SELECT * FROM DIEM

----CAU 2----
GO
CREATE FUNCTION TKSV (@TMH NAVRCHAR(20))
RETURNS INT
AS
BEGIN
DECLARE @DEM INT
SET @DEM = ( SELECT COUNT(*) FROM DIEM WHERE @DEM < 5 )
RETURN @DEM
END
GO
SELECT Dbo.TKSV ('BIG DATA')

----CAU 3----
GO
CREATE PROCEDURE DIEM(@MASV CHAR(5),@MAMON CHAR(5),@DIEMTHI FLOAT)
AS
INSERT INTO DIEM(MASV,MAMON,DIEMTHI)VALUES(@MASV,@MAMON,@DIEMTHI)
GO
DIEM 'SV2','MH3',9

----CAU 4----
GO
CREATE TRIGGER THEM_SUA ON DIEM
FOR INSERT, UPDATE
AS
IF(SELECT DIEMTHI FROM INSERTED)>10 AND(SELECT DIEMTHI FROM INSERTED)<0
BEGIN
PRINT'KHONG CHO PHEP'
ROLLBACK TRANSACTION
END
INSERT INTO DIEM VALUES ('SV1','MH3','2')